# Claude Code Web UI - 决策日志

记录项目中的关键决策和理由。

---

## 2025-02-10

### 决策 1: 选择 React + Express 技术栈
**决策人**: PM
**时间**: 2025-02-10
**状态**: ✅ 已确定

**背景**: 需要选择前后端技术栈

**选项**:
- A: React + Express (MVC)
- B: Next.js (全栈)
- C: Vue + Fastify

**决策**: 选择 A - React + Express

**理由**:
1. 团队熟悉度最高
2. 前后端分离便于并行开发
3. 简单稳定，风险低
4. 48小时内可交付

**影响**: 前端和后端独立开发和部署

---

### 决策 2: 使用 SQLite 而非 PostgreSQL
**决策人**: PM
**时间**: 2025-02-10
**状态**: ✅ 已确定

**背景**: 需要选择数据库

**选项**:
- A: SQLite (零配置)
- B: PostgreSQL (生产级)
- C: 文件直接读取 (无DB)

**决策**: 选择 A - SQLite

**理由**:
1. 零配置，开箱即用
2. 单机应用足够
3. 支持索引和查询
4. 未来可迁移到 PostgreSQL

**影响**: 数据存储在本地文件，无需数据库服务器

---

### 决策 3: MVP 功能范围
**决策人**: PM
**时间**: 2025-02-10
**状态**: ✅ 已确定

**背景**: 定义48小时内必须完成的功能

**决策**:
- ✅ P0: Dashboard、会话管理、消息历史、工具记录、Skill管理
- ⏸️ P1: 搜索筛选、项目管理、待办事项
- ❌ P2: 导出、主题切换 (V2)

**理由**:
- 48小时时间紧迫
- 必须演示核心功能
- 可扩展功能延后

**影响**: V1 版本功能精简但可用

---

### 决策 4: Mock 先行策略
**决策人**: PM
**时间**: 2025-02-10
**状态**: ✅ 已确定

**背景**: FE 和 BE 如何并行开发

**决策**: FE 使用 MSW 创建 Mock API，不等待 BE

**理由**:
1. 前后端解耦，并行开发
2. FE 可独立演示
3. API 契约清晰后再联调

**影响**: FE 从 Day 1 就可运行和演示

---

### 决策 5: 读取本地 Claude Code 历史文件
**决策人**: PM
**时间**: 2025-02-10
**状态**: ✅ 已确定

**背景**: 历史记录数据源

**决策**: BE 直接读取 `~/.local/share/opencode/` 和 `~/.opencode/skills/` 下的文件

**理由**:
1. 无需修改 Claude Code
2. 实时获取最新数据
3. 参考 OpenCode 桌面版数据结构

**影响**: 依赖 OpenCode 的文件格式

---

### 决策 6: 参考 OpenCode 桌面版设计
**决策人**: PM
**时间**: 2025-02-10
**状态**: ✅ 已确定

**背景**: 需要设计 Web UI 的功能和界面

**决策**: 参考 OpenCode 桌面版的功能和交互设计

**理由**:
1. OpenCode 桌面版功能完善，用户体验好
2. 数据结构与 Claude Code 相似
3. 可直接参考现有实现，降低设计成本
4. 用户可以平滑过渡

**参考功能**:
- 三栏布局（项目导航 + 聊天区域 + 工具面板）
- 会话管理（创建、编辑、删除）
- 消息时间线（含工具调用展示）
- Skill 管理（启用/禁用）
- 代码变更追踪

**影响**: UI 设计以 OpenCode 为蓝本，保持一致的用户体验

---

### 决策 7: 采用三栏桌面端布局
**决策人**: PM
**时间**: 2025-02-10
**状态**: ✅ 已确定

**背景**: 需要确定主界面布局

**决策**: 桌面端采用三栏布局（左：会话列表，中：聊天区，右：工具/Skills）

**理由**:
1. 参考 OpenCode 桌面版，用户熟悉
2. 信息密度高，操作便捷
3. 可折叠侧边栏适应不同场景

**响应式策略**:
- Desktop (≥1280px): 三栏
- Tablet (768-1279px): 两栏
- Mobile (<768px): 单栏 + Tab

**影响**: FE 需要实现响应式三栏布局

---

## 待决策事项

- [ ] 是否需要用户认证？
- [ ] V2 版本的功能优先级？
- [ ] 是否支持主题切换（Light/Dark）？
**决策人**: PM  
**时间**: 2025-02-10  
**状态**: ✅ 已确定  

**背景**: 需要选择前后端技术栈  

**选项**:
- A: React + Express (MVC)
- B: Next.js (全栈)
- C: Vue + Fastify

**决策**: 选择 A - React + Express  

**理由**:
1. 团队熟悉度最高
2. 前后端分离便于并行开发
3. 简单稳定，风险低
4. 48小时内可交付

**影响**: 前端和后端独立开发和部署

---

### 决策 2: 使用 SQLite 而非 PostgreSQL
**决策人**: PM  
**时间**: 2025-02-10  
**状态**: ✅ 已确定  

**背景**: 需要选择数据库  

**选项**:
- A: SQLite (零配置)
- B: PostgreSQL (生产级)
- C: 文件直接读取 (无DB)

**决策**: 选择 A - SQLite  

**理由**:
1. 零配置，开箱即用
2. 单机应用足够
3. 支持索引和查询
4. 未来可迁移到 PostgreSQL

**影响**: 数据存储在本地文件，无需数据库服务器

---

### 决策 3: MVP 功能范围
**决策人**: PM  
**时间**: 2025-02-10  
**状态**: ✅ 已确定  

**背景**: 定义48小时内必须完成的功能  

**决策**:
- ✅ P0: Dashboard、历史记录列表/详情、Skill列表/详情
- ⏸️ P1: 搜索筛选、快捷操作
- ❌ P2: 导出、主题切换 (V2)

**理由**:
- 48小时时间紧迫
- 必须演示核心功能
- 可扩展功能延后

**影响**: V1 版本功能精简但可用

---

### 决策 4: Mock 先行策略
**决策人**: PM  
**时间**: 2025-02-10  
**状态**: ✅ 已确定  

**背景**: FE 和 BE 如何并行开发  

**决策**: FE 使用 MSW 创建 Mock API，不等待 BE  

**理由**:
1. 前后端解耦，并行开发
2. FE 可独立演示
3. API 契约清晰后再联调

**影响**: FE 从 Day 1 就可运行和演示

---

### 决策 5: 读取本地 Claude Code 历史文件
**决策人**: PM  
**时间**: 2025-02-10  
**状态**: ✅ 已确定  

**背景**: 历史记录数据源  

**决策**: BE 直接读取 `~/.claude/history/` 下的文件  

**理由**:
1. 无需修改 Claude Code
2. 实时获取最新数据
3. 简单直接

**影响**: 依赖 Claude Code 的文件格式

---

### 决策 6: 参考 OpenCode 桌面版设计
**决策人**: PM  
**时间**: 2025-02-10  
**状态**: ✅ 已确定  

**背景**: 需要设计 Web UI 的功能和界面  

**决策**: 参考 OpenCode 桌面版的功能和交互设计  

**理由**:
1. OpenCode 桌面版功能完善，用户体验好
2. 数据结构与 Claude Code 相似
3. 可直接参考现有实现，降低设计成本
4. 用户可以平滑过渡

**参考功能**:
- 三栏布局（项目导航 + 聊天区域 + 工具面板）
- 会话管理（创建、编辑、删除）
- 消息时间线（含工具调用展示）
- Skill 管理（启用/禁用）
- 代码变更追踪

**影响**: UI 设计以 OpenCode 为蓝本，保持一致的用户体验

---

### 决策 7: 采用三栏桌面端布局
**决策人**: PM  
**时间**: 2025-02-10  
**状态**: ✅ 已确定  

**背景**: 需要确定主界面布局  

**决策**: 桌面端采用三栏布局（左：会话列表，中：聊天区，右：工具/Skills）  

**理由**:
1. 参考 OpenCode 桌面版，用户熟悉
2. 信息密度高，操作便捷
3. 可折叠侧边栏适应不同场景

**响应式策略**:
- Desktop (≥1280px): 三栏
- Tablet (768-1279px): 两栏
- Mobile (<768px): 单栏 + Tab

**影响**: FE 需要实现响应式三栏布局

---

### 决策 8: 范围限定 - 仅实现 Claude Code 支持的功能
**决策人**: PM  
**时间**: 2025-02-11  
**状态**: ✅ 已确定  

**背景**: 之前参考了 OpenCode 桌面版的功能，但发现很多功能 Claude Code 本身不支持  

**决策**: 只实现 Claude Code 本身支持的功能，排除 OpenCode 特有功能  

**保留功能** (Claude Code 支持):
- ✅ Claude Code 状态检测
- ✅ 历史记录查看 (history.jsonl)
- ✅ Agent 管理 (settings.json)
- ✅ MCP 管理 (claude mcp)
- ✅ 权限配置查看 (settings.local.json)
- ✅ 待办事项 (todos/)
- ✅ 任务管理 (tasks/)
- ✅ 团队管理 (teams/)

**排除功能** (OpenCode 特有):
- ❌ Skill 管理
- ❌ 多 LLM 提供商切换
- ❌ LSP 代码分析
- ❌ 代码变更 Diff 追踪
- ❌ Token 消耗统计
- ❌ 插件系统

**理由**:
1. 专注 Claude Code 本身能力
2. 避免实现不存在的数据源
3. 48小时时间有限，聚焦核心功能
4. 降低复杂度，提高完成度

**影响**: 
- 简化 MVP 范围
- 移除 Skill 管理模块
- 聚焦状态检测和历史记录

---

## 待决策事项

| 事项 | 说明 | 优先级 |
|------|------|--------|
| 用户认证 | 是否需要登录功能？ | 低 |
| 主题切换 | 是否支持 Light/Dark 模式？ | 中 |
| V2 功能优先级 | V2 版本先做什么功能？ | 低 |

---

**最后更新**: 2025-02-11  
**维护人**: PM  
