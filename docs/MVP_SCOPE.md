# Claude Code Web UI - MVP 功能范围

## 项目目标
开发 Claude Code 的可视化 Web 界面，支持状态检测、会话管理、历史记录查看和 Agent 管理。

**范围说明**: 只实现 Claude Code 本身支持的功能，不包含 OpenCode 特有功能（如 Skill 管理、多提供商支持等）。

---

## 功能优先级

### 🔴 P0 - MVP 必须有 (48小时内必须完成)

#### 1. 🏠 Dashboard 首页

- [ ] **Claude Code 状态检测** ⭐ 核心功能
  - 实时检测 Claude Code 进程是否在运行
  - 状态指示器：🟢 运行中 / 🔴 未运行
  - 显示运行时长
  - 显示当前工作目录
  - 最后活动时间
  - 一键启动/重启按钮（如果未运行）

- [ ] **当前 Agent 信息**
  - 显示当前激活的 Agent（如 PM、FE、BE、QA）
  - Agent 描述
  - 允许的工具列表

- [ ] **最近会话** - 展示最近 5-10 个会话
  - 会话标题
  - 最后消息预览
  - 时间戳
  - 点击进入会话详情

- [ ] **统计卡片**
  - 总会话数
  - 今日消息数
  - 当前工作目录
  - Claude Code 运行状态

**UI 布局**:
```
┌────────────────────────────────────────────┐
│ 🏠 Dashboard                                │
├────────────────────────────────────────────┤
│ 🟢 Claude Code 运行中                        │
│ 运行时长: 2小时34分 | 工作目录: /projects   │
│ 最后活动: 5分钟前                           │
├────────────────────────────────────────────┤
│ 🤖 当前 Agent: PM (项目经理)                │
│ 允许工具: Read, Edit, Write                 │
├────────────────────────────────────────────┤
│ 📊 统计概览                                  │
│ ┌──────────┬──────────┬──────────┐         │
│ │ 128 会话 │ 42 今日  │ /projects│         │
│ └──────────┴──────────┴──────────┘         │
├────────────────────────────────────────────┤
│ 💬 最近会话                                  │
│ • 初始化项目架构              2小时前       │
│ • React 组件设计              昨天          │
│ • API 接口讨论                昨天          │
└────────────────────────────────────────────┘
```

**Claude Code 未运行状态**:
```
┌────────────────────────────────────────────┐
│ 🔴 Claude Code 未运行                        │
│ 检测到 Claude Code 进程未启动                │
│ [🚀 启动 Claude Code]                       │
└────────────────────────────────────────────┘
```

---

#### 2. 💬 会话管理模块

- [ ] **会话列表页**
  - 按时间分组（今天、昨天、更早）
  - 会话标题（从 history.jsonl 解析）
  - 最后更新时间
  - 消息数量统计
  - 点击进入会话详情

- [ ] **会话详情页（历史记录查看）**
  - 消息时间线展示
  - 消息类型区分：
    - 👤 用户消息
    - 🤖 Claude 回复
    - 🛠️ 工具调用记录
  - 时间戳显示
  - 复制消息内容
  - 粘贴内容追踪显示（Claude 特有）

**UI 布局**:
```
┌────────────────────────────────────────────┐
│ 🎯 Header: 搜索 | 设置                     │
├──────────────┬─────────────────────────────┤
│              │                             │
│  💬 会话列表  │      💬 历史记录            │
│  ┌──────────┐│                             │
│  │ 🔥 今天   ││  👤 用户 10:23             │
│  │ 项目架构  ││  帮我创建一个 React 项目    │
│  ├──────────┤│                             │
│  │ 📅 昨天   ││  🤖 Claude 10:23           │
│  │ 组件设计  ││  好的，我来帮你...          │
│  └──────────┘│                             │
│              │  🛠️ 工具调用: Bash          │
│              │  $ npx create-react-app     │
│              │  ✅ 执行成功                │
└──────────────┴─────────────────────────────┘
```

---

#### 3. 🤖 Agent 管理模块

- [ ] **Agent 列表**
  - 显示 settings.json 中定义的 Agents
  - Agent 名称和描述
  - 允许的工具列表
  - 当前激活的 Agent 高亮显示

- [ ] **Agent 详情**
  - Agent 完整描述
  - System Prompt 预览
  - 允许的工具列表
  - 权限配置

**UI 布局**:
```
┌────────────────────────────────────────────┐
│ 🤖 Agents                                   │
├────────────────────────────────────────────┤
│ 已配置 (4)                                  │
├────────────────────────────────────────────┤
│ 🎯 PM (项目经理)              [当前激活]   │
│    决策中枢、风险兜底、需求裁剪             │
│    工具: Read, Edit, Write                  │
├────────────────────────────────────────────┤
│ 🎨 FE (前端工程师)                          │
│    界面完整性、Mock先行、对接治理           │
│    工具: Read, Edit, Write, Bash            │
├────────────────────────────────────────────┤
│ ⚙️ BE (后端工程师)                          │
│    服务启动、数据层修复、接口实现           │
│    工具: Read, Edit, Write, Bash            │
├────────────────────────────────────────────┤
│ 🧪 QA (测试工程师)                          │
│    现状审计、冒烟测试、数据工厂             │
│    工具: Read, Write, Bash                  │
└────────────────────────────────────────────┘
```

---

#### 4. 🔧 MCP 管理模块

- [ ] **MCP 服务器列表**
  - 显示已配置的 MCP 服务器
  - 服务器名称和描述
  - 状态：已启用/已禁用
  - 工具数量

- [ ] **MCP 详情**
  - 服务器配置信息
  - 提供的工具列表
  - 启用/禁用开关

**UI 布局**:
```
┌────────────────────────────────────────────┐
│ 🔧 MCP Servers                              │
├────────────────────────────────────────────┤
│ 已配置 (2)                                  │
├────────────────────────────────────────────┤
│ 📦 filesystem                               │
│    文件系统操作                             │
│    状态: 已启用 | 工具: 5个                 │
├────────────────────────────────────────────┤
│ 🌐 fetch                                    │
│    HTTP 请求                                │
│    状态: 已启用 | 工具: 2个                 │
└────────────────────────────────────────────┘
```

---

#### 5. 🔐 权限管理模块

- [ ] **权限概览**
  - 显示当前权限模式
  - 允许的工具列表
  - 允许的 Bash 命令列表
  - 禁止的工具列表

- [ ] **权限详情**
  - 来自 settings.local.json 的配置
  - 权限规则展示
  - 修改建议

**UI 布局**:
```
┌────────────────────────────────────────────┐
│ 🔐 权限配置                                  │
├────────────────────────────────────────────┤
│ 当前模式: acceptEdits                       │
├────────────────────────────────────────────┤
│ ✅ 允许的工具                                │
│ • Read, Edit, Write                         │
│ • Bash (wc:*, find:*, npm install:*)       │
├────────────────────────────────────────────┤
│ ❌ 禁止的工具                                │
│ • Bash (rm:*, sudo:*)                      │
└────────────────────────────────────────────┘
```

---

### 🟡 P1 - 应该有 (有时间就做)

#### 6. 🔍 全局搜索
- [ ] 搜索历史消息（关键词）
- [ ] 搜索会话
- [ ] 过滤器：时间范围

#### 7. 📁 工作目录管理
- [ ] 最近工作目录列表
- [ ] 快速切换目录
- [ ] 目录元数据展示

#### 8. ✅ 待办事项 (Todos)
- [ ] 显示 ~/.claude/todos/ 中的任务
- [ ] 按会话分组的任务列表
- [ ] 任务状态（pending/completed）

#### 9. 📋 任务管理 (Tasks)
- [ ] 显示 ~/.claude/tasks/ 中的任务
- [ ] 任务列表和详情

#### 10. 👥 团队管理 (Teams)
- [ ] 显示 ~/.claude/teams/ 中的团队
- [ ] 团队成员和配置

---

### 🟢 P2 - 可以有 (V2版本)

#### 11. 📊 统计洞察
- [ ] 使用数据分析
- [ ] 活跃度趋势
- [ ] 消息数量统计

#### 12. 📤 导出功能
- [ ] 导出会话为 Markdown
- [ ] 导出历史记录

#### 13. 🎨 个性化
- [ ] 主题切换（Light/Dark）
- [ ] 字体大小调整

#### 14. 🔧 高级功能
- [ ] 设置编辑器
- [ ] 配置同步
- [ ] 日志查看器

---

## 界面布局设计

### 桌面端 (推荐布局)
```
┌─────────────────────────────────────────────────────────────┐
│  🎯 Header: 搜索 🔍 | 设置 ⚙️ | Claude 状态 🟢              │
├──────────────┬──────────────────────────────┬───────────────┤
│              │                              │               │
│  💬          │                              │      🤖       │
│  会话        │                              │      Agents   │
│  列表        │      💬 历史记录             │               │
│              │      (消息时间线)            ├───────────────│
│  ────────────┤                              │      🔧       │
│              │                              │      MCP      │
│  📁          │                              │               │
│  工作目录    │                              ├───────────────│
│              │                              │      🔐       │
│              │                              │      权限     │
├──────────────┴──────────────────────────────┴───────────────┤
│ 💭 快速操作栏                                               │
└─────────────────────────────────────────────────────────────┘
```

**布局说明**:
- **左侧栏**: 会话列表 + 工作目录（可折叠）
- **中间**: 历史记录查看（主要工作区）
- **右侧栏**: Agents + MCP + 权限（可折叠）
- **底部**: 快速操作栏

### 响应式断点
- **Desktop**: ≥1280px - 三栏布局
- **Tablet**: 768px-1279px - 两栏布局
- **Mobile**: <768px - 单栏 + Tab 切换

---

## 数据结构

### 会话 (Session) - 从 history.jsonl 解析
```typescript
interface Session {
  id: string;           // sessionId from history
  title: string;        // 从第一条消息解析或默认
  project: string;      // 工作目录
  createdAt: number;    // timestamp
  updatedAt: number;    // 最后消息时间
  messageCount: number; // 消息数量
}
```

### 消息 (Message) - 来自 history.jsonl
```typescript
interface Message {
  id: string;           // 生成的 ID
  sessionId: string;    // 所属会话
  role: 'user' | 'assistant';
  content: string;      // display 字段
  timestamp: number;
  pastedContents?: {    // Claude 特有：粘贴内容追踪
    [id: string]: {
      type: 'text';
      content: string;
    }
  };
}
```

### Agent - 来自 settings.json
```typescript
interface Agent {
  name: string;         // pm, fe, be, qa
  description: string;
  prompt: string;       // system prompt
  allowedTools: string[]; // ["Read", "Edit", "Write", "Bash"]
}
```

### MCP Server - 来自 claude mcp list
```typescript
interface MCPServer {
  name: string;
  description?: string;
  enabled: boolean;
  tools: string[];
  config?: object;
}
```

### 权限配置 - 来自 settings.local.json
```typescript
interface Permissions {
  allow: string[];      // ["Bash(wc:*)", "Read"]
  deny?: string[];      // 可选
}
```

---

## 数据来源

### 1. Claude Code 进程状态
```bash
ps aux | grep -i "claude" | grep -v grep
```

### 2. 历史记录
- **文件**: `~/.claude/history.jsonl`
- **格式**: JSON Lines
- **内容**: 所有会话的消息历史

### 3. Agent 配置
- **文件**: `~/.claude/settings.json`
- **字段**: `agents.{name}`

### 4. 权限配置
- **文件**: `~/.claude/settings.local.json`
- **字段**: `permissions.allow`

### 5. MCP 配置
- **命令**: `claude mcp list`
- **存储**: Claude Code 内部

### 6. 待办事项
- **目录**: `~/.claude/todos/`
- **文件**: `{session-id}-agent-{agent-id}.json`

### 7. 任务
- **目录**: `~/.claude/tasks/`

### 8. 团队
- **目录**: `~/.claude/teams/`

---

## 技术约束

### 前端
- React 18 + TypeScript + Vite
- Ant Design 5 + Tailwind CSS
- React Query (数据获取)
- React Router 6 (路由)
- 响应式布局（桌面优先）

### 后端
- Node.js 20 + Express
- TypeScript
- SQLite + Prisma
- REST API

### 数据集成
- 读取 `~/.claude/history.jsonl`
- 读取 `~/.claude/settings.json`
- 读取 `~/.claude/settings.local.json`
- 读取 `~/.claude/todos/`
- 读取 `~/.claude/tasks/`
- 读取 `~/.claude/teams/`
- 执行 `claude mcp list` 命令
- 检测 Claude Code 进程状态

---

## 验收标准

### P0 必须完成
- ✅ Claude Code 状态实时检测
- ✅ 会话列表和历史记录查看
- ✅ Agent 列表和详情查看
- ✅ MCP 服务器列表（如果有配置）
- ✅ 权限配置查看
- ✅ 界面流畅，核心操作 < 3秒

### 质量要求
- ✅ 前端可独立运行（Mock数据）
- ✅ 后端服务稳定响应
- ✅ 无阻断性 Bug（崩溃、白屏）
- ✅ 响应式布局正常

---

## 明确排除的功能（OpenCode 特有）

以下功能 **不做**（Claude Code 不支持）：

- ❌ Skill 管理（OpenCode 特有）
- ❌ 多 LLM 提供商切换（OpenCode 特有）
- ❌ LSP 代码分析（OpenCode 特有）
- ❌ 代码变更 Diff 追踪（OpenCode 特有）
- ❌ Token 消耗统计（Claude Code 不暴露）
- ❌ 父子消息关联（Claude Code 不明显）
- ❌ 工具执行持久化存储（Claude Code 不存储）
- ❌ 插件系统（OpenCode 特有）

---

## 风险与应对

| 风险 | 可能性 | 影响 | 应对策略 |
|------|--------|------|----------|
| history.jsonl 格式变化 | 中 | 中 | 封装适配层，不直接暴露原始结构 |
| 历史记录文件过大 | 中 | 中 | 分页加载 + 索引优化 |
| 48小时时间不足 | 高 | 高 | 严格执行P0范围，P1/P2果断裁剪 |
| MCP/Agent 配置复杂 | 中 | 低 | 优先展示，编辑功能延后 |

---

## 参考文档

- [ARCHITECTURE.md](./ARCHITECTURE.md) - 技术架构设计
- [PROJECT_STATUS.md](./PROJECT_STATUS.md) - 项目实时状态
- [CLAUdecode_VS_OPENCODE.md](./CLAUdecode_VS_OPENCODE.md) - 功能对比分析

---

**最后更新**: 2025-02-11  
**负责人**: PM  
**状态**: 🚧 规划中  
**范围**: 仅 Claude Code 支持的功能  
